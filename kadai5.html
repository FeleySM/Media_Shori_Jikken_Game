<!-- アニメーション -->
<!doctype html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Sample</title>
    <script src="js/three.js"></script>
    <script src="js/OrbitControls.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', exec); // body が読み込み終わるまで待つ

        var width = 960;
        var height = 600;
        var side = 10;
        var border = 100;
        var scene;
        var camera;
        var mesh; // 回転させるメッシュ(課題4−1用)
        var renderer;
        var light;
        var mesh2;
        var shiftx = 0,
            shifty = 0;

        function exec() {

            document.addEventListener('keydown', function(e) {
                switch (e.key) {
                    case 'w':
                        shifty = 1;
                        break;
                    case 'a':
                        shiftx = -1;
                        break;
                    case 's':
                        shifty = -1;
                        break;
                    case 'd':
                        shiftx = 1;
                        break;
                }
            });
            document.addEventListener('keyup', function(e) {
                switch (e.key) {
                    case 'w':
                        shifty = 0;
                        break;
                    case 'a':
                        shiftx = 0;
                        break;
                    case 's':
                        shifty = 0;
                        break;
                    case 'd':
                        shiftx = 0;
                        break;
                }
            });

            var texture = new THREE.TextureLoader().load('https://cdn.pixabay.com/photo/2017/08/15/08/23/stars-2643089_1280.jpg');
            var geometry = new THREE.BoxBufferGeometry(400, 400, 400);
            var material = new THREE.MeshBasicMaterial({
                map: texture
            });
            var bg = new THREE.Mesh(geometry, material);

            // シーンを作る
            scene = new THREE.Scene();
            // ライトの設定
            light = new THREE.DirectionalLight(0xffffff, 2.0);
            //light = new THREE.PointLight(0xFFFFFF, 2, 100, 1.0);
            light.position.set(-1, 1, 1); // ライトの向きを変更
            scene.add(light);
            var amb_light = new THREE.AmbientLight(0xFFFFFF, 0.5);
            scene.add(amb_light);
            scene.add(bg);
            var geometry1 = new THREE.BoxGeometry(side * 2, side * 2, side * 2);
            var material1 = new THREE.MeshPhongMaterial({
                color: 0xff2918
            });
            mesh = new THREE.Mesh(geometry1, material1);
            scene.add(mesh);
            mesh.position.set(0, -70, 200);

            // カメラを設定
            camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 1, 1000);
            camera.position.set(0, 0, 470);
            camera.lookAt(scene.position);
            scene.add(camera)

            //レンダラを作成
            renderer = new THREE.WebGLRenderer({
                canvas: document.getElementById('canvas1')
            });
            renderer.setSize(window.innerWidth, window.innerHeight);

            // カメラコントローラーを作成
            var controls = new THREE.OrbitControls(camera, renderer.domElement);

            update();
        }

        function update() {
            if (mesh.position.x > -190 + side && mesh.position.x < 190 - side) {
                mesh.position.x += shiftx;
            }
            if (mesh.position.y > -100 + side && mesh.position.y < 100 - side) {
                mesh.position.y += shifty;
            }
            renderer.render(scene, camera);　 // レンダラーに描画することを命令する
            requestAnimationFrame(update);
        }

        function checkCollision() {

        }
    </script>

</head>

<body>
    <h1>第6回メディア処理実験</h1>

    <canvas id="canvas1" style="width: 960; height: 600;"></canvas>
</body>

</html>